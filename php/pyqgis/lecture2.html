<!doctype html>
<html lang="en">

  <head>
    <meta charset="utf-8">

    <title>[02] Introduction into plugin creation</title>

    <meta name="description" content="Basics of QGIS scripting and plugin creation.">
    <meta name="author" content="Pavel Grochal">

    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <link rel="stylesheet" href="/css/bootstrap.dark.min.css" id="theme">
    <link rel="stylesheet" href="/css/reveal.min.css">
    <link rel="stylesheet" href="/css/theme/darkless.css" id="theme">
    <link rel="stylesheet" href="/css/reveal.custom.css">


    <!-- For syntax highlighting -->
    <link rel="stylesheet" href="/lib/css/zenburn.css">

    <!-- If the query includes 'print-pdf', use the PDF print sheet -->
    <script>
      document.write( '<link rel="stylesheet" href="/css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );
    </script>

    <!--[if lt IE 9]>
    <script src="/lib/js/html5shiv.js"></script>
    <![endif]-->
  </head>

  <body>

    <div class="reveal">

      <!-- Any section element inside of this container is displayed as a slide -->
      <div class="slides">

        <section>
          <h1>PyQGIS</h1>
          <h3><small>[02]</small> Introduction into plugin creation</h3>
        </section>

        <section>
          <section>
            <h2 class="title">What is (QGIS) plugin?</h2>
            <p>
              Easy way to include additional functionality into a program (QGIS).
            </p>
            <p>
              This additional functionality allows to use programming language as a benefit.
            </p>
          </section>

          <section>
            <h2 class="title">The language of QGIS plugin?</h2>
            <div style="display:inline-block; vertical-align:top;">
              <img src="https://www.python.org/static/img/python-logo.png" alt="Python logo" />
              <div class="small">
                <a href="https://www.python.org/about/">https://www.python.org/about</a>
              </div>

            </div>
            <div style="display:inline-block; text-align:left !important;"><cite>
Python is powerful... and fast;<br>
plays well with others;<br>
runs everywhere;<br>
is friendly & easy to learn;<br>
is Open.</cite></div>
          </section>

          <section>
            <h2 class="title">Plugin basic structure</h2>
            <ul class="tree">
              <li>MyPlugin
                <ul>
                  <li>metadata.txt</li>
                  <li>icon.png</li>
                  <li>__init__.py</li>
                  <li>mainPlugin.py</li>
                </ul>
              </li>
            </ul>
          </section>

          <section>
            <!-- metadata.txt -->
            <div><pre><code data-trim contenteditable contextmenu>
[general]

name=My Plugin
qgisMinimumVersion=2.0
description=Some description of my plugin
about=Detailed description of the plugin.
  No HTML, but we can use multiple lines.
version=0.0.1

author=Pavel Grochal
email=darkless69@gmail.com

tracker=bug_tracker_placeholder
repository=repository_placeholder

category=Raster

# Recommended items:
icon=icon.png
experimental=True

            </code></pre></div>

            <div style="position:absolute; right:0; top:0; z-index:999; border:1px solid #999999; padding:5px; font-size:0.7em; background-color:#111">
              <ul class="tree">
                <li class="red">metadata.txt</li>
                <li>icon.png</li>
                <li>__init__.py</li>
                <li>mainPlugin.py</li>
              </ul>
            </div>
          </section>

          <section>
            <!-- icon.png -->
            <div class="">
              <img src="/pyqgis/img/icon.png" alt="" style="border:none;" />
            </div>

            <div style="position:absolute; right:0; top:0; z-index:999; border:1px solid #999999; padding:5px; font-size:0.7em; background-color:#111">
              <ul class="tree">
                <li>metadata.txt</li>
                <li class="red">icon.png</li>
                <li>__init__.py</li>
                <li>mainPlugin.py</li>
              </ul>
            </div>
          </section>

          <section>
            <!-- __init__.py -->
            <div><pre><code class="python" data-trim contenteditable contextmenu>
# -*- coding: utf-8 -*-


def classFactory(iface):
    from mainPlugin import Plugin
    return Plugin(iface)
            </code></pre></div>

            <div style="position:absolute; right:0; top:0; z-index:999; border:1px solid #999999; padding:5px; font-size:0.7em; background-color:#111">
              <ul class="tree">
                <li>metadata.txt</li>
                <li>icon.png</li>
                <li class="red">__init__.py</li>
                <li>mainPlugin.py</li>
              </ul>
            </div>
          </section>

          <section>
            <!-- MyPlugin.py -->
            <div><pre><code class="python" data-trim contenteditable contextmenu style="max-height:100% !important">
# -*- coding: utf-8 -*-


class Plugin:
    def __init__(self, iface):
        # This method is called on initialization of plugin ("The first method")
        self._iface = iface
        print "Initialiting My Plugin"

    def initGui(self):
        # This method is called when the plugin is loaded
        print "Loading My Plugin"

    def unload(self):
        # This method is called when the plugin is
        print "Unloading My Plugin"
            </code></pre></div>

            <div style="position:absolute; right:0; top:0; z-index:999; border:1px solid #999999; padding:5px; font-size:0.7em; background-color:#111">
              <ul class="tree">
                <li>metadata.txt</li>
                <li>icon.png</li>
                <li>__init__.py</li>
                <li class="red">mainPlugin.py</li>
              </ul>
            </div>
          </section>

          <section>
            <h2 class="title">Where does the plugin go?</h2>
            <div><pre><code>~/.qgis2/python/plugins</code></pre></div>
          </section>

          <section>
            <h2 class="title">Plugin Reloader</h2>
            <h3 class="small"><span class="text-warning">[* Tip for plugin!]</span></h3>
          </section>

          <section>
            <p><span class="text-success">Plugin Reloader</span> is plugin used for reloading other plugins.
              It helps refresh source coude which results in <span class="text-success">developing faster</span> without the need of restarting whole QGIS.</p>
          </section>

          <section>
            <h2 class="title">Live DEMO</h2>
            <aside class="notes">
              <ol>
                <li>Show python console</li>
                <li>Show how to install plugin</li>
                <li>Show how to unintall plugin</li>
                <li>Show console output</li>
              </ol>
            </aside>
          </section>

        </section>

        <section>
          <section>
            <h2>Hands on experience</h2>
          </section>

          <section>
              <h2 class="title">First steps:</h2>
              <ol>
                <li>Install Plugin Reloader</li>
                <li>Download plugin skeleton: <a href="/pyqgis/files/MyPlugin_skeleton.zip">MyPlugin_skeleton.zip</a></li>
                <li>Extract to:<pre><code>~/.qgis2/python/plugins</code></pre></li>
                <li>Edit <b>metadata.txt</b> so it contains your credentials</li>
                <li>Open QGIS, python console and try to install / uninstall plugin</li>
              </ol>
          </section>

          <section>
            <h2 class="title">GUI elements</h2>
            <p>
              GUI <span class="small">{Graphical User Interface}</span> is written in Qt <span class="small">[kjuÀêt]</span> framework, <br>which uses PyQt bindings.
            </p>
            <p>To create an actual interface (windows, buttons, etc.) <br>we can use program called "Qt Designer"</p>
          </section>

          <section>
            <h2 class="title">Generating form.ui</h2>
            <ol>
              <li>File &rarr; New</li>
              <li>Dialog with Buttons Bottom</li>
              <li>Create</li>
              <li>File &rarr; Save As "form.ui"</li>
            </ol>
            <pre><code>~/.qgis2/python/plugins/MyPlugin/form.ui</code></pre>
          </section>

          <section>
            <h2 class="title">Generating resources.qrc</h2>
            <ol>
              <li>Resource Browser <small>(bottom right corner in Qt Designer)</small></li>
              <li>Edit Resources</li>
              <li>New Resource File</li>
              <pre><code>~/.qgis2/python/plugins/MyPlugin/resources.qrc</code></pre>
              <li>Add Prefix &rarr; "plugins/myplugin"</li>
              <li>Add Files &rarr; icon.png</li>
              <li>OK</li>
            </ol>
          </section>

          <section>
            <h2>New files</h2>
            <ul class="tree">
              <li>MyPlugin
                <ul>
                  <li>metadata.txt</li>
                  <li>icon.png</li>
                  <li>__init__.py</li>
                  <li>mainPlugin.py</li>
                  <li class="red">form.ui</li>
                  <li class="red">resources.qrc</li>
                </ul>
              </li>
            </ul>
          </section>

          <section>
            <!-- form.ui -->
            <div><pre><code class="xml" data-trim contenteditable>
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;ui version="4.0"&gt;
 &lt;class&gt;Dialog&lt;/class&gt;
 &lt;widget class="QDialog" name="Dialog"&gt;
  &lt;property name="geometry"&gt;
   &lt;rect&gt;
    &lt;x&gt;0&lt;/x&gt;
    &lt;y&gt;0&lt;/y&gt;
    &lt;width&gt;400&lt;/width&gt;
    &lt;height&gt;300&lt;/height&gt;
   &lt;/rect&gt;
  &lt;/property&gt;
  &lt;property name="windowTitle"&gt;
   &lt;string&gt;Dialog&lt;/string&gt;
  &lt;/property&gt;

  ...
            </code></pre></div>

            <div style="position:absolute; right:0; top:0; z-index:999; border:1px solid #999999; padding:5px; font-size:0.7em; background-color:#111">
              <ul class="tree">
                <li>metadata.txt</li>
                <li>icon.png</li>
                <li>__init__.py</li>
                <li>mainPlugin.py</li>
                <li class="red">form.ui</li>
                <li>resources.qrc</li>
              </ul>
            </div>
          </section>

          <section>
            <!-- resources.qrc -->
            <div><pre><code class="xml" data-trim contenteditable>
&lt;RCC&gt;
  &lt;qresource prefix=&quot;plugins/myplugin&quot;&gt;
    &lt;file&gt;icon.png&lt;/file&gt;
  &lt;/qresource&gt;
&lt;/RCC&gt;
            </code></pre></div>

            <div style="position:absolute; right:0; top:0; z-index:999; border:1px solid #999999; padding:5px; font-size:0.7em; background-color:#111">
              <ul class="tree">
                <li>metadata.txt</li>
                <li>icon.png</li>
                <li>__init__.py</li>
                <li>mainPlugin.py</li>
                <li>form.ui</li>
                <li class="red">resources.qrc</li>
              </ul>
            </div>
          </section>

          <section>
            <h2>Generating python files</h2>
            <h4 class="title">(form.py, resources.py)</h4>
            <p>Execute in terminal <small>[Ctrl + Alt + T]</small></p>
            <div><pre><code data-trim>
cd ~/.qgis2/python/plugins/MyPlugin/

pyuic4 form.ui -o form.py

pyrcc4 resources.qrc -o resources.py
            </code></pre></div>
          </section>

          <section>
            <h2>Newly created files</h2>
            <ul class="tree">
              <li>MyPlugin
                <ul>
                  <li>metadata.txt</li>
                  <li>icon.png</li>
                  <li>__init__.py</li>
                  <li>mainPlugin.py</li>
                  <li>form.ui</li>
                  <li class="red">form.py</li>
                  <li>resources.qrc</li>
                  <li class="red">resources.py</li>
                </ul>
              </li>
            </ul>
            <p>&nbsp;</p>
            <div class="text-danger">
              Never edit files <strong class="red">form.py</strong> and <strong class="red">resources.py</strong> directly! <br>
              They can and will get overridden on next change.
            </div>
          </section>

          <section>
            <h2 class="title">Updating mainPlugin.py</h2>
          </section>

          <section>
            <h2>Imports </h2>
            <div><pre><code class="python" data-trim contenteditable style="max-height:100%">
# -*- coding: utf-8 -*-
import os
from PyQt4.QtCore import *
from PyQt4.QtGui import *
from qgis.core import *

# initialize Qt resources from file resources.py
import resources

class Plugin:
    def __init__(self, iface):
        # This method is called on initialization of plugin ("The first method")
        self._iface = iface
        print "Initialiting My Plugin"

    def initGui(self):
        # This method is called when the plugin is loaded
        print "Loading My Plugin"

    def unload(self):
        # This method is called when the plugin is
        print "Unloading My Plugin"
            </code></pre></div>
            <div style="position:absolute; right:0; top:0; z-index:999; border:1px solid #999999; padding:5px; font-size:0.7em; background-color:#111">
              <ul class="tree">
                <li>metadata.txt</li>
                <li>icon.png</li>
                <li>__init__.py</li>
                <li class="red">mainPlugin.py</li>
                <li>form.ui</li>
                <li>form.py</li>
                <li>resources.qrc</li>
                <li>resources.py</li>
              </ul>
            </div>
          </section>

          <section>
            <h2>initGui()</h2>
            <div><pre><code class="python" data-trim contenteditable style="max-height:100%">
def initGui(self):
    # This method is called when the plugin is loaded
    print "Loading My Plugin"
    # create action that will start plugin configuration
    self.action = QAction( QIcon(":/plugins/myplugin/icon.png"),
                           "My First Plugin Action",
                           self._iface.mainWindow() )
    self.action.setObjectName("testAction")
    self.action.setWhatsThis("Configuration for My First Plugin")
    self.action.setStatusTip("This is status tip")
    QObject.connect(self.action, SIGNAL("triggered()"), self.run)

    # add toolbar button and menu item
    self._iface.addToolBarIcon(self.action)
    self._iface.addPluginToMenu("&amp;My Plugins", self.action)

    # connect to signal renderComplete which is emitted when canvas
    # rendering is done
    QObject.connect( self._iface.mapCanvas(),
                     SIGNAL("renderComplete(QPainter *)"),
                     self.renderTest )

            </code></pre></div>
            <div style="position:absolute; right:0; top:0; z-index:999; border:1px solid #999999; padding:5px; font-size:0.7em; background-color:#111">
              <ul class="tree">
                <li>metadata.txt</li>
                <li>icon.png</li>
                <li>__init__.py</li>
                <li class="red">mainPlugin.py</li>
                <li>form.ui</li>
                <li>form.py</li>
                <li>resources.qrc</li>
                <li>resources.py</li>
              </ul>
            </div>
          </section>

          <section>
            <h2>unload()</h2>
            <div><pre><code class="python" data-trim contenteditable style="max-height:100%">
def unload(self):
    # This method is called when the plugin is
    print "Unloading My Plugin"
    # remove the plugin menu item and icon
    self._iface.removePluginMenu("&amp;My plugins", self.action)
    self._iface.removeToolBarIcon(self.action)

    # disconnect form signal of the canvas
    QObject.disconnect( self._iface.mapCanvas(),
                        SIGNAL("renderComplete(QPainter *)"),
                        self.renderTest )
            </code></pre></div>
            <div style="position:absolute; right:0; top:0; z-index:999; border:1px solid #999999; padding:5px; font-size:0.7em; background-color:#111">
              <ul class="tree">
                <li>metadata.txt</li>
                <li>icon.png</li>
                <li>__init__.py</li>
                <li class="red">mainPlugin.py</li>
                <li>form.ui</li>
                <li>form.py</li>
                <li>resources.qrc</li>
                <li>resources.py</li>
              </ul>
            </div>
          </section>

          <section>
            <h2>new methods</h2>
            <div><pre><code class="python" data-trim contenteditable style="max-height:100%">
class Plugin:

    ...

    def run(self):
        # create and show a configuration dialog or something similar
        print "TestPlugin: run called!"

    def renderTest(self, painter):
        # use painter for drawing to map canvas
        print "TestPlugin: renderTest called!"
            </code></pre></div>
            <div style="position:absolute; right:0; top:0; z-index:999; border:1px solid #999999; padding:5px; font-size:0.7em; background-color:#111">
              <ul class="tree">
                <li>metadata.txt</li>
                <li>icon.png</li>
                <li>__init__.py</li>
                <li class="red">mainPlugin.py</li>
                <li>form.ui</li>
                <li>form.py</li>
                <li>resources.qrc</li>
                <li>resources.py</li>
              </ul>
            </div>
          </section>

          <section>
            <h2 class="title">Live DEMO</h2>
            <aside class="notes">
              <ol>
                <li>Open python console</li>
                <li>Show how to install plugin</li>
                <li>Show how to unintall plugin</li>
                <li>Click on plugin button</li>
              </ol>
            </aside>
          </section>

        </section>

        <section>
          <section>
            <h2 class="title">Showing dialog</h2>
          </section>

          <section>
            <p>Create new file <span class="text-success">formDialog.py</span></p>
            <ul class="tree">
              <li>MyPlugin
                <ul>
                  <li>metadata.txt</li>
                  <li>icon.png</li>
                  <li>__init__.py</li>
                  <li>mainPlugin.py</li>
                  <li>form.ui</li>
                  <li>form.py</li>
                  <li class="red">formDialog.py</li>
                  <li>resources.qrc</li>
                  <li>resources.py</li>
                </ul>
              </li>
            </ul>
          </section>

          <section>
            <div><pre><code class="python" data-trim contenteditable style="max-height:100%">
import sys
from PyQt4 import QtCore, QtGui
from form import Ui_Dialog

class FormDialog(QtGui.QDialog):
    def __init__(self, parent=None):
        QtGui.QWidget.__init__(self, parent)
        self.ui = Ui_Dialog()
        self.ui.setupUi(self)
            </code></pre></div>
            <div style="position:absolute; right:0; top:0; z-index:999; border:1px solid #999999; padding:5px; font-size:0.7em; background-color:#111">
              <ul class="tree">
                <li>metadata.txt</li>
                <li>icon.png</li>
                <li>__init__.py</li>
                <li>mainPlugin.py</li>
                <li>form.ui</li>
                <li>form.py</li>
                <li class="red">formDialog.py</li>
                <li>resources.qrc</li>
                <li>resources.py</li>
              </ul>
            </div>
          </section>

          <section>
          <div><pre><code class="python" data-trim contenteditable style="max-height:100%">
...

from formDialog import FormDialog

class Plugin:

    def initGui(self):
        # Build GUI window
        self.dlg = FormDialog()

        ...

    def run(self):
        # create and show a configuration dialog or something similar
        self.dlg.show()
        print "My Plugin: run called!"

    ...

            </code></pre></div>
            <div style="position:absolute; right:0; top:0; z-index:999; border:1px solid #999999; padding:5px; font-size:0.7em; background-color:#111">
              <ul class="tree">
                <li>metadata.txt</li>
                <li>icon.png</li>
                <li>__init__.py</li>
                <li class="red">mainPlugin.py</li>
                <li>form.ui</li>
                <li>form.py</li>
                <li>formDialog.py</li>
                <li>resources.qrc</li>
                <li>resources.py</li>
              </ul>
            </div>
          </section>

          <section>
            <h2 class="title">Live DEMO</h2>
          </section>
        </section>


        <section>
            <h1>Thank you for your attention.</h1>
        </section>

      </div>

    </div>

    <script src="/lib/js/head.min.js"></script>
    <script src="/js/reveal.min.js"></script>

    <script>

      // Full list of configuration options available here:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        controls: true,
        progress: true,
        history: true,
        center: true,

        theme: Reveal.getQueryHash().theme, // available themes are in //css/theme
        transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/fade/none

        // Optional libraries used to extend on reveal.js
        dependencies: [
          { src: '../lib/js/classList.js', condition: function() { return !document.body.classList; } },
          { src: '../plugin/markdown/showdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: '../plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: '../plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
          { src: '../plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
          { src: '../plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
          //{ src: 'plugin/remotes/remotes.js', async: true, condition: function() { return !!document.body.classList; } }
        ]
      });

    </script>

  </body>
</html>
